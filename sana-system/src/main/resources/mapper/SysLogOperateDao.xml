<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.sana.system.dao.SysLogOperateDao">

    <insert id="insertTd">
        ${sql}
    </insert>


    <insert id="saveBatch">
        insert into sys_log_operate (module, name, req_uri, req_method, req_params, ip, user_agent, operate_type, duration, status, user_id, real_name, create_time)
        values
        <foreach item="item" index="index" collection="optLogEntityList" separator=",">
            ( #{item.module}, #{item.name}, #{item.reqUri}, #{item.reqMethod}, #{item.reqParams}, #{item.ip}, #{item.userAgent}, #{item.operateType}, #{item.duration}, #{item.status}, #{item.userId}, #{item.realName},NOW())
        </foreach>
    </insert>


    <select id="getListsTd" resultType="com.sana.system.entity.result.SysLogOperateResult">
        select *
        from  sys_log_operate where user_id = #{query.userId} ORDER BY ts DESC
    </select>
    <select id="getSysListsTd" resultType="com.sana.system.entity.result.SysLogOperateResult">
        select *
        from  sys_log_operate
        <where>
        <if test="query.operateType !=null">
            and operate_type = #{query.operateType}
        </if>
        <if test="query.startTime !=null and query.startTime != ''">
            and ts >= #{query.startTime}
        </if>
        <if test="query.endTime !=null and query.endTime != ''">
            and ts  &lt; #{query.endTime}
        </if>
        </where>
        ORDER BY ts DESC
    </select>
    <select id="getSysLogListsTd" resultType="com.sana.system.entity.result.SysLogOperateResult">
        select *
        from  sys_log_operate
        <where>
            <if test="query.operateType !=null and query.operateType != ''">
                and operate_type in (1,2,3,4)
            </if>
            <if test="query.startTime !=null and query.startTime != ''">
                and ts >= #{query.startTime}
            </if>
            <if test="query.endTime !=null and query.endTime != ''">
                and ts  &lt; #{query.endTime}
            </if>
        </where>
        ORDER BY ts DESC
    </select>
    <select id="getdeviceLogListsTd" resultType="com.sana.system.entity.result.SysLogOperateResult">
        select *
        from  sys_log_operate
        <where>
            <if test="query.operateType !=null and query.operateType != ''">
                and operate_type in (0,5,6)
            </if>
            <if test="query.startTime !=null and query.startTime != ''">
                and ts >= #{query.startTime}
            </if>
            <if test="query.endTime !=null and query.endTime != ''">
                and ts  &lt; #{query.endTime}
            </if>
        </where>
        ORDER BY ts DESC
    </select>
    <select id="getCommunLogListsTd" resultType="com.sana.system.entity.result.SysLogOperateResult">
        select *
        from  sys_log_operate
        <where>
            <if test="query.operateType !=null and query.operateType != ''">
                and operate_type in (7,8)
            </if>
            <if test="query.startTime !=null and query.startTime != ''">
                and ts >= #{query.startTime}
            </if>
            <if test="query.endTime !=null and query.endTime != ''">
                and ts  &lt; #{query.endTime}
            </if>
        </where>
        ORDER BY ts DESC
    </select>
    <select id="getJobData" resultType="com.sana.system.entity.result.JobInfoResult"
            parameterType="java.lang.String">
        SELECT
            qjd.JOB_NAME AS jobName,
            qjd.JOB_GROUP AS jobGroup,
            qct.TRIGGER_GROUP AS triggerGroup,
            qct.TRIGGER_NAME AS triggerName,
            qct.CRON_EXPRESSION AS cron
        FROM  QRTZ_CRON_TRIGGERS qct
                  LEFT JOIN QRTZ_TRIGGERS qt ON qct.TRIGGER_GROUP = qt.TRIGGER_GROUP
                  LEFT JOIN QRTZ_JOB_DETAILS qjd  ON qt.JOB_GROUP = qjd.JOB_GROUP
        WHERE
            qjd.JOB_CLASS_NAME = #{logsClassName}
    </select>


    <select id="getSysLogLists" resultType="com.sana.system.entity.result.SysLogOperateResult">
        select *
        from  sys_log_operate
        <where>
            <if test="query.operateType !=null and query.operateType != ''">
                and operate_type in (1,2,3,4)
            </if>
            <if test="query.startTime !=null and query.endTime !=null">
                and create_time BETWEEN #{query.startTime} AND #{query.endTime}
            </if>
        </where>
        ORDER BY create_time DESC
    </select>


    <select id="getdeviceLogLists" resultType="com.sana.system.entity.result.SysLogOperateResult">
        select
        id,
        module as module,
        `name` as name,
        req_uri as reqUri,
        req_method as reqMethod,
        req_params as reqParams,
        ip,
        user_agent as userAgent,
        operate_type as operateType,
        duration,
        `status`,
        user_id as userId,
        real_name as realName,
        create_time as createTime
        from  sys_log_operate
        <where>
            <if test="query.operateType !=null and query.operateType != ''">
                and operate_type in (0,5,6)
            </if>
            <if test="query.startTime !=null and query.endTime !=null">
                and create_time BETWEEN #{query.startTime} AND #{query.endTime}
            </if>
        </where>
        ORDER BY create_time DESC

    </select>
    <select id="getCommunLogLists" resultType="com.sana.system.entity.result.SysLogOperateResult">
        select
        id,
        module as module,
        `name` as name,
        req_uri as reqUri,
        req_method as reqMethod,
        req_params as reqParams,
        ip,
        user_agent as userAgent,
        operate_type as operateType,
        duration,
        `status`,
        user_id as userId,
        real_name as realName,
        create_time as createTime
        from  sys_log_operate
        <where>
            <if test="query.operateType !=null and query.operateType != ''">
                and operate_type in (7,8)
            </if>
            <if test="query.startTime !=null and query.endTime !=null">
                and create_time BETWEEN #{query.startTime} AND #{query.endTime}
            </if>
        </where>
        ORDER BY create_time DESC
    </select>
    <select id="getSysLists" resultType="com.sana.system.entity.result.SysLogOperateResult">
        select
        id,
        module as module,
        `name` as name,
        req_uri as reqUri,
        req_method as reqMethod,
        req_params as reqParams,
        ip,
        user_agent as userAgent,
        operate_type as operateType,
        duration,
        `status`,
        user_id as userId,
        real_name as realName,
        create_time as createTime
        from  sys_log_operate
        <where>
            <if test="query.operateType !=null">
                and operate_type = #{query.operateType}
            </if>
            <if test="query.startTime !=null and query.endTime !=null">
                and create_time BETWEEN #{query.startTime} AND #{query.endTime}
            </if>
        </where>
        ORDER BY create_time DESC
    </select>
    <select id="getLists" resultType="com.sana.system.entity.result.SysLogOperateResult">
        select
            id,
            module as module,
            `name` as name,
            req_uri as reqUri,
            req_method as reqMethod,
            req_params as reqParams,
            ip,
            user_agent as userAgent,
            operate_type as operateType,
            duration,
            `status`,
            user_id as userId,
            real_name as realName,
            create_time as createTime
        from  sys_log_operate where user_id = #{query.userId} ORDER BY create_time DESC
    </select>


</mapper>